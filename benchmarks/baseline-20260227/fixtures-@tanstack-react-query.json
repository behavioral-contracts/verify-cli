{
  "tool": "@behavioral-contracts/verify-cli",
  "tool_version": "0.1.0",
  "corpus_version": "1.0.0",
  "timestamp": "2026-02-27T16:55:36.807Z",
  "tsconfig": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/tsconfig.json",
  "packages_analyzed": [
    "zod",
    "yup",
    "ws",
    "winston",
    "validator",
    "uuid",
    "unzipper",
    "undici",
    "typescript",
    "typeorm",
    "twilio",
    "tedious",
    "supertest",
    "stripe",
    "superagent",
    "square",
    "sqlite3",
    "sinon",
    "simple-oauth2",
    "socket.io",
    "sequelize",
    "sharp",
    "request-promise",
    "redis",
    "react-hook-form",
    "pino",
    "puppeteer",
    "pg",
    "socket.io-client",
    "openai",
    "passport",
    "node-fetch",
    "next",
    "nodemailer",
    "mysql2",
    "multer",
    "mongoose",
    "moment",
    "mongodb",
    "luxon",
    "mocha",
    "lodash",
    "knex",
    "jsonwebtoken",
    "ioredis",
    "helmet",
    "graphql",
    "joi",
    "got",
    "firebase-admin",
    "fastify",
    "express",
    "ethers",
    "dayjs",
    "drizzle-orm",
    "discord.js",
    "date-fns",
    "cloudinary",
    "cors",
    "chai",
    "cassandra-driver",
    "bull",
    "bcryptjs",
    "bullmq",
    "axios",
    "ajv",
    "archiver",
    "@vercel/postgres",
    "@tanstack/react-query",
    "@sendgrid/mail",
    "@supabase/supabase-js",
    "@slack/web-api",
    "@prisma/client",
    "@octokit/rest",
    "@nestjs/common",
    "@clerk/nextjs",
    "@aws-sdk/client-s3",
    "@anthropic-ai/sdk",
    "@hapi/hapi"
  ],
  "contracts_applied": 400,
  "files_analyzed": 3,
  "violations": [
    {
      "id": "@tanstack/react-query-query-error-unhandled",
      "severity": "error",
      "file": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/instance-usage.ts",
      "line": 276,
      "column": 5,
      "package": "@tanstack/react-query",
      "function": "useQuery",
      "contract_clause": "query-error-unhandled",
      "description": "Async function 'handlePrefetch' contains unprotected await expression. await queryClient.prefetchQuery({\n      queryKey: ... may throw unhandled errors.",
      "source_doc": "https://tanstack.com/query/latest/docs/framework/react/guides/query-functions",
      "suggested_fix": "Caller MUST handle query errors using one of these methods:\n1. Check the `error` property and `isError` state returned by useQuery, OR\n2. Wrap the component in an ErrorBoundary with throwOnError: true, OR\n3. Provide an onError callback in query options.\n\nQuery errors are NOT thrown - they are returned in the error property.\nIgnoring the error state leaves users with broken UI and no feedback.\n",
      "code_snippet": {
        "startLine": 272,
        "endLine": 280,
        "lines": [
          {
            "line": 272,
            "content": "  const queryClient = useQueryClient();",
            "highlighted": false
          },
          {
            "line": 273,
            "content": "",
            "highlighted": false
          },
          {
            "line": 274,
            "content": "  const handlePrefetch = async (userId: string) => {",
            "highlighted": false
          },
          {
            "line": 275,
            "content": "    // ❌ VIOLATION: No try-catch around prefetch",
            "highlighted": false
          },
          {
            "line": 276,
            "content": "    await queryClient.prefetchQuery({",
            "highlighted": true
          },
          {
            "line": 277,
            "content": "      queryKey: ['user', userId],",
            "highlighted": false
          },
          {
            "line": 278,
            "content": "      queryFn: async () => {",
            "highlighted": false
          },
          {
            "line": 279,
            "content": "        const response = await fetch(`/api/users/${userId}`);",
            "highlighted": false
          },
          {
            "line": 280,
            "content": "        if (!response.ok) throw new Error('Prefetch failed');",
            "highlighted": false
          }
        ]
      }
    },
    {
      "id": "@tanstack/react-query-query-error-unhandled",
      "severity": "error",
      "file": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/missing-error-handling.ts",
      "line": 139,
      "column": 5,
      "package": "@tanstack/react-query",
      "function": "useQuery",
      "contract_clause": "query-error-unhandled",
      "description": "Async function 'handleSubmit' contains unprotected await expression. await mutation.mutateAsync(formData)... may throw unhandled errors.",
      "source_doc": "https://tanstack.com/query/latest/docs/framework/react/guides/query-functions",
      "suggested_fix": "Caller MUST handle query errors using one of these methods:\n1. Check the `error` property and `isError` state returned by useQuery, OR\n2. Wrap the component in an ErrorBoundary with throwOnError: true, OR\n3. Provide an onError callback in query options.\n\nQuery errors are NOT thrown - they are returned in the error property.\nIgnoring the error state leaves users with broken UI and no feedback.\n",
      "code_snippet": {
        "startLine": 135,
        "endLine": 143,
        "lines": [
          {
            "line": 135,
            "content": "  });",
            "highlighted": false
          },
          {
            "line": 136,
            "content": "",
            "highlighted": false
          },
          {
            "line": 137,
            "content": "  const handleSubmit = async (formData: { name: string }) => {",
            "highlighted": false
          },
          {
            "line": 138,
            "content": "    // ❌ VIOLATION: No try-catch around mutateAsync",
            "highlighted": false
          },
          {
            "line": 139,
            "content": "    await mutation.mutateAsync(formData);",
            "highlighted": true
          },
          {
            "line": 140,
            "content": "    console.log('User updated');",
            "highlighted": false
          },
          {
            "line": 141,
            "content": "  };",
            "highlighted": false
          },
          {
            "line": 142,
            "content": "",
            "highlighted": false
          },
          {
            "line": 143,
            "content": "  return (",
            "highlighted": false
          }
        ]
      }
    },
    {
      "id": "@tanstack/react-query-query-error-unhandled",
      "severity": "error",
      "file": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/missing-error-handling.ts",
      "line": 19,
      "column": 31,
      "package": "@tanstack/react-query",
      "function": "useQuery",
      "contract_clause": "query-error-unhandled",
      "description": "No error handling found. Errors will crash the application.",
      "source_doc": "https://tanstack.com/query/latest/docs/framework/react/guides/query-functions",
      "suggested_fix": "Caller MUST handle query errors using one of these methods:\n1. Check the `error` property and `isError` state returned by useQuery, OR\n2. Wrap the component in an ErrorBoundary with throwOnError: true, OR\n3. Provide an onError callback in query options.\n\nQuery errors are NOT thrown - they are returned in the error property.\nIgnoring the error state leaves users with broken UI and no feedback.\n",
      "code_snippet": {
        "startLine": 15,
        "endLine": 23,
        "lines": [
          {
            "line": 15,
            "content": " * ❌ Missing error handling - not checking isError or error property",
            "highlighted": false
          },
          {
            "line": 16,
            "content": " * Should trigger: query-error-unhandled",
            "highlighted": false
          },
          {
            "line": 17,
            "content": " */",
            "highlighted": false
          },
          {
            "line": 18,
            "content": "function UserProfileNoErrorHandling({ userId }: { userId: string }) {",
            "highlighted": false
          },
          {
            "line": 19,
            "content": "  const { data, isLoading } = useQuery({",
            "highlighted": true
          },
          {
            "line": 20,
            "content": "    queryKey: ['user', userId],",
            "highlighted": false
          },
          {
            "line": 21,
            "content": "    queryFn: async () => {",
            "highlighted": false
          },
          {
            "line": 22,
            "content": "      const response = await fetch(`/api/users/${userId}`);",
            "highlighted": false
          },
          {
            "line": 23,
            "content": "      if (!response.ok) throw new Error('Failed to fetch user');",
            "highlighted": false
          }
        ]
      }
    },
    {
      "id": "@tanstack/react-query-mutation-error-unhandled",
      "severity": "error",
      "file": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/missing-error-handling.ts",
      "line": 90,
      "column": 20,
      "package": "@tanstack/react-query",
      "function": "useMutation",
      "contract_clause": "mutation-error-unhandled",
      "description": "No error handling found. Errors will crash the application.",
      "source_doc": "https://tanstack.com/query/latest/docs/framework/react/guides/mutations",
      "suggested_fix": "Caller MUST handle mutation errors using one of these methods:\n1. Check the `error` property and `isError` state returned by useMutation, OR\n2. Provide onError callback in mutation options, OR\n3. Handle errors in the .catch() when calling mutate/mutateAsync, OR\n4. Configure global mutation error handler via QueryClient mutationCache.onError.\n\nMutations modify server state - users MUST know if they failed.\nSilent failures lead to data inconsistency and user confusion.\n",
      "code_snippet": {
        "startLine": 86,
        "endLine": 94,
        "lines": [
          {
            "line": 86,
            "content": " * ❌ Missing mutation error handling",
            "highlighted": false
          },
          {
            "line": 87,
            "content": " * Should trigger: mutation-error-unhandled",
            "highlighted": false
          },
          {
            "line": 88,
            "content": " */",
            "highlighted": false
          },
          {
            "line": 89,
            "content": "function CreateUserFormNoErrorHandling() {",
            "highlighted": false
          },
          {
            "line": 90,
            "content": "  const mutation = useMutation({",
            "highlighted": true
          },
          {
            "line": 91,
            "content": "    mutationFn: async (userData: { name: string; email: string }) => {",
            "highlighted": false
          },
          {
            "line": 92,
            "content": "      const response = await fetch('/api/users', {",
            "highlighted": false
          },
          {
            "line": 93,
            "content": "        method: 'POST',",
            "highlighted": false
          },
          {
            "line": 94,
            "content": "        headers: { 'Content-Type': 'application/json' },",
            "highlighted": false
          }
        ]
      }
    },
    {
      "id": "@tanstack/react-query-mutation-error-unhandled",
      "severity": "error",
      "file": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/missing-error-handling.ts",
      "line": 126,
      "column": 20,
      "package": "@tanstack/react-query",
      "function": "useMutation",
      "contract_clause": "mutation-error-unhandled",
      "description": "No error handling found. Errors will crash the application.",
      "source_doc": "https://tanstack.com/query/latest/docs/framework/react/guides/mutations",
      "suggested_fix": "Caller MUST handle mutation errors using one of these methods:\n1. Check the `error` property and `isError` state returned by useMutation, OR\n2. Provide onError callback in mutation options, OR\n3. Handle errors in the .catch() when calling mutate/mutateAsync, OR\n4. Configure global mutation error handler via QueryClient mutationCache.onError.\n\nMutations modify server state - users MUST know if they failed.\nSilent failures lead to data inconsistency and user confusion.\n",
      "code_snippet": {
        "startLine": 122,
        "endLine": 130,
        "lines": [
          {
            "line": 122,
            "content": " * ❌ Using mutateAsync without try-catch",
            "highlighted": false
          },
          {
            "line": 123,
            "content": " * Should trigger: mutation-error-unhandled",
            "highlighted": false
          },
          {
            "line": 124,
            "content": " */",
            "highlighted": false
          },
          {
            "line": 125,
            "content": "function UpdateUserFormNoTryCatch({ userId }: { userId: string }) {",
            "highlighted": false
          },
          {
            "line": 126,
            "content": "  const mutation = useMutation({",
            "highlighted": true
          },
          {
            "line": 127,
            "content": "    mutationFn: async (userData: { name: string }) => {",
            "highlighted": false
          },
          {
            "line": 128,
            "content": "      const response = await fetch(`/api/users/${userId}`, {",
            "highlighted": false
          },
          {
            "line": 129,
            "content": "        method: 'PUT',",
            "highlighted": false
          },
          {
            "line": 130,
            "content": "        body: JSON.stringify(userData),",
            "highlighted": false
          }
        ]
      }
    },
    {
      "id": "@tanstack/react-query-mutation-error-unhandled",
      "severity": "error",
      "file": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/missing-error-handling.ts",
      "line": 159,
      "column": 20,
      "package": "@tanstack/react-query",
      "function": "useMutation",
      "contract_clause": "mutation-error-unhandled",
      "description": "No error handling found. Errors will crash the application.",
      "source_doc": "https://tanstack.com/query/latest/docs/framework/react/guides/mutations",
      "suggested_fix": "Caller MUST handle mutation errors using one of these methods:\n1. Check the `error` property and `isError` state returned by useMutation, OR\n2. Provide onError callback in mutation options, OR\n3. Handle errors in the .catch() when calling mutate/mutateAsync, OR\n4. Configure global mutation error handler via QueryClient mutationCache.onError.\n\nMutations modify server state - users MUST know if they failed.\nSilent failures lead to data inconsistency and user confusion.\n",
      "code_snippet": {
        "startLine": 155,
        "endLine": 163,
        "lines": [
          {
            "line": 155,
            "content": " * ❌ Optimistic update without error rollback",
            "highlighted": false
          },
          {
            "line": 156,
            "content": " * Should trigger: mutation-optimistic-update-rollback",
            "highlighted": false
          },
          {
            "line": 157,
            "content": " */",
            "highlighted": false
          },
          {
            "line": 158,
            "content": "function TodoToggleNoRollback({ todoId, queryClient }: { todoId: string; queryClient: any }) {",
            "highlighted": false
          },
          {
            "line": 159,
            "content": "  const mutation = useMutation({",
            "highlighted": true
          },
          {
            "line": 160,
            "content": "    mutationFn: async ({ id, completed }: { id: string; completed: boolean }) => {",
            "highlighted": false
          },
          {
            "line": 161,
            "content": "      const response = await fetch(`/api/todos/${id}`, {",
            "highlighted": false
          },
          {
            "line": 162,
            "content": "        method: 'PUT',",
            "highlighted": false
          },
          {
            "line": 163,
            "content": "        body: JSON.stringify({ completed }),",
            "highlighted": false
          }
        ]
      }
    },
    {
      "id": "@tanstack/react-query-mutation-optimistic-update-rollback",
      "severity": "error",
      "file": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/missing-error-handling.ts",
      "line": 159,
      "column": 20,
      "package": "@tanstack/react-query",
      "function": "useMutation",
      "contract_clause": "mutation-optimistic-update-rollback",
      "description": "Optimistic update without rollback. UI will show incorrect data on error.",
      "source_doc": "https://tanstack.com/query/latest/docs/framework/react/guides/optimistic-updates",
      "suggested_fix": "When using optimistic updates, the onError callback MUST roll back the optimistic changes.\n\nRequired pattern:\n```\nonMutate: async (newData) => {\n  await queryClient.cancelQueries({ queryKey })\n  const previousData = queryClient.getQueryData(queryKey)\n  queryClient.setQueryData(queryKey, newData) // optimistic update\n  return { previousData } // context for rollback\n},\nonError: (err, newData, context) => {\n  queryClient.setQueryData(queryKey, context.previousData) // ROLLBACK\n}\n```\n\nWithout rollback, failed mutations leave UI showing incorrect data.\n",
      "code_snippet": {
        "startLine": 155,
        "endLine": 163,
        "lines": [
          {
            "line": 155,
            "content": " * ❌ Optimistic update without error rollback",
            "highlighted": false
          },
          {
            "line": 156,
            "content": " * Should trigger: mutation-optimistic-update-rollback",
            "highlighted": false
          },
          {
            "line": 157,
            "content": " */",
            "highlighted": false
          },
          {
            "line": 158,
            "content": "function TodoToggleNoRollback({ todoId, queryClient }: { todoId: string; queryClient: any }) {",
            "highlighted": false
          },
          {
            "line": 159,
            "content": "  const mutation = useMutation({",
            "highlighted": true
          },
          {
            "line": 160,
            "content": "    mutationFn: async ({ id, completed }: { id: string; completed: boolean }) => {",
            "highlighted": false
          },
          {
            "line": 161,
            "content": "      const response = await fetch(`/api/todos/${id}`, {",
            "highlighted": false
          },
          {
            "line": 162,
            "content": "        method: 'PUT',",
            "highlighted": false
          },
          {
            "line": 163,
            "content": "        body: JSON.stringify({ completed }),",
            "highlighted": false
          }
        ]
      }
    },
    {
      "id": "@tanstack/react-query-infinite-query-error-unhandled",
      "severity": "error",
      "file": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/missing-error-handling.ts",
      "line": 202,
      "column": 7,
      "package": "@tanstack/react-query",
      "function": "useInfiniteQuery",
      "contract_clause": "infinite-query-error-unhandled",
      "description": "No error handling found. Errors will crash the application.",
      "source_doc": "https://tanstack.com/query/latest/docs/framework/react/guides/infinite-queries",
      "suggested_fix": "Caller MUST handle errors when fetching additional pages:\n1. Check `error` and `isError` state, OR\n2. Check `fetchNextPageError` for page-specific errors, OR\n3. Provide onError callback in query options.\n\nWhen fetchNextPage fails, previously loaded pages remain accessible via `data`.\nUser must be informed that loading more failed.\n",
      "code_snippet": {
        "startLine": 198,
        "endLine": 206,
        "lines": [
          {
            "line": 198,
            "content": "    data,",
            "highlighted": false
          },
          {
            "line": 199,
            "content": "    fetchNextPage,",
            "highlighted": false
          },
          {
            "line": 200,
            "content": "    hasNextPage,",
            "highlighted": false
          },
          {
            "line": 201,
            "content": "    isFetchingNextPage,",
            "highlighted": false
          },
          {
            "line": 202,
            "content": "  } = useInfiniteQuery({",
            "highlighted": true
          },
          {
            "line": 203,
            "content": "    queryKey: ['users', 'infinite'],",
            "highlighted": false
          },
          {
            "line": 204,
            "content": "    queryFn: async ({ pageParam = 0 }) => {",
            "highlighted": false
          },
          {
            "line": 205,
            "content": "      const response = await fetch(`/api/users?page=${pageParam}`);",
            "highlighted": false
          },
          {
            "line": 206,
            "content": "      if (!response.ok) throw new Error('Failed to fetch users');",
            "highlighted": false
          }
        ]
      }
    },
    {
      "id": "@tanstack/react-query-mutation-error-unhandled",
      "severity": "error",
      "file": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/missing-error-handling.ts",
      "line": 285,
      "column": 30,
      "package": "@tanstack/react-query",
      "function": "useMutation",
      "contract_clause": "mutation-error-unhandled",
      "description": "No error handling found. Errors will crash the application.",
      "source_doc": "https://tanstack.com/query/latest/docs/framework/react/guides/mutations",
      "suggested_fix": "Caller MUST handle mutation errors using one of these methods:\n1. Check the `error` property and `isError` state returned by useMutation, OR\n2. Provide onError callback in mutation options, OR\n3. Handle errors in the .catch() when calling mutate/mutateAsync, OR\n4. Configure global mutation error handler via QueryClient mutationCache.onError.\n\nMutations modify server state - users MUST know if they failed.\nSilent failures lead to data inconsistency and user confusion.\n",
      "code_snippet": {
        "startLine": 281,
        "endLine": 289,
        "lines": [
          {
            "line": 281,
            "content": " * ❌ Parallel mutations without coordination",
            "highlighted": false
          },
          {
            "line": 282,
            "content": " * Should trigger: mutation-parallel-execution (warning)",
            "highlighted": false
          },
          {
            "line": 283,
            "content": " */",
            "highlighted": false
          },
          {
            "line": 284,
            "content": "function ParallelMutationsNoCoordination() {",
            "highlighted": false
          },
          {
            "line": 285,
            "content": "  const updateNameMutation = useMutation({",
            "highlighted": true
          },
          {
            "line": 286,
            "content": "    mutationFn: async (name: string) => {",
            "highlighted": false
          },
          {
            "line": 287,
            "content": "      const response = await fetch('/api/user/name', {",
            "highlighted": false
          },
          {
            "line": 288,
            "content": "        method: 'PUT',",
            "highlighted": false
          },
          {
            "line": 289,
            "content": "        body: JSON.stringify({ name }),",
            "highlighted": false
          }
        ]
      }
    },
    {
      "id": "@tanstack/react-query-mutation-error-unhandled",
      "severity": "error",
      "file": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/missing-error-handling.ts",
      "line": 296,
      "column": 31,
      "package": "@tanstack/react-query",
      "function": "useMutation",
      "contract_clause": "mutation-error-unhandled",
      "description": "No error handling found. Errors will crash the application.",
      "source_doc": "https://tanstack.com/query/latest/docs/framework/react/guides/mutations",
      "suggested_fix": "Caller MUST handle mutation errors using one of these methods:\n1. Check the `error` property and `isError` state returned by useMutation, OR\n2. Provide onError callback in mutation options, OR\n3. Handle errors in the .catch() when calling mutate/mutateAsync, OR\n4. Configure global mutation error handler via QueryClient mutationCache.onError.\n\nMutations modify server state - users MUST know if they failed.\nSilent failures lead to data inconsistency and user confusion.\n",
      "code_snippet": {
        "startLine": 292,
        "endLine": 300,
        "lines": [
          {
            "line": 292,
            "content": "      return response.json();",
            "highlighted": false
          },
          {
            "line": 293,
            "content": "    },",
            "highlighted": false
          },
          {
            "line": 294,
            "content": "  });",
            "highlighted": false
          },
          {
            "line": 295,
            "content": "",
            "highlighted": false
          },
          {
            "line": 296,
            "content": "  const updateEmailMutation = useMutation({",
            "highlighted": true
          },
          {
            "line": 297,
            "content": "    mutationFn: async (email: string) => {",
            "highlighted": false
          },
          {
            "line": 298,
            "content": "      const response = await fetch('/api/user/email', {",
            "highlighted": false
          },
          {
            "line": 299,
            "content": "        method: 'PUT',",
            "highlighted": false
          },
          {
            "line": 300,
            "content": "        body: JSON.stringify({ email }),",
            "highlighted": false
          }
        ]
      }
    },
    {
      "id": "@tanstack/react-query-query-error-unhandled",
      "severity": "error",
      "file": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/missing-error-handling.ts",
      "line": 326,
      "column": 31,
      "package": "@tanstack/react-query",
      "function": "useQuery",
      "contract_clause": "query-error-unhandled",
      "description": "No error handling found. Errors will crash the application.",
      "source_doc": "https://tanstack.com/query/latest/docs/framework/react/guides/query-functions",
      "suggested_fix": "Caller MUST handle query errors using one of these methods:\n1. Check the `error` property and `isError` state returned by useQuery, OR\n2. Wrap the component in an ErrorBoundary with throwOnError: true, OR\n3. Provide an onError callback in query options.\n\nQuery errors are NOT thrown - they are returned in the error property.\nIgnoring the error state leaves users with broken UI and no feedback.\n",
      "code_snippet": {
        "startLine": 322,
        "endLine": 330,
        "lines": [
          {
            "line": 322,
            "content": " * ❌ Not handling background refetch errors for stale queries",
            "highlighted": false
          },
          {
            "line": 323,
            "content": " * Should trigger: stale-query-refetch-error",
            "highlighted": false
          },
          {
            "line": 324,
            "content": " */",
            "highlighted": false
          },
          {
            "line": 325,
            "content": "function StaleDataNoRefetchErrorHandling({ userId }: { userId: string }) {",
            "highlighted": false
          },
          {
            "line": 326,
            "content": "  const { data, isLoading } = useQuery({",
            "highlighted": true
          },
          {
            "line": 327,
            "content": "    queryKey: ['user', userId],",
            "highlighted": false
          },
          {
            "line": 328,
            "content": "    queryFn: async () => {",
            "highlighted": false
          },
          {
            "line": 329,
            "content": "      const response = await fetch(`/api/users/${userId}`);",
            "highlighted": false
          },
          {
            "line": 330,
            "content": "      if (!response.ok) throw new Error('Failed to fetch user');",
            "highlighted": false
          }
        ]
      }
    }
  ],
  "summary": {
    "total_violations": 11,
    "error_count": 11,
    "warning_count": 0,
    "info_count": 0,
    "passed": false
  },
  "package_discovery": {
    "total": 14,
    "withContracts": 4,
    "withoutContracts": 10,
    "packages": [
      {
        "name": "@tanstack/react-query",
        "version": "unknown",
        "source": "import",
        "hasContract": true,
        "contractVersion": "1.0.0",
        "usedIn": [
          "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/instance-usage.ts",
          "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/missing-error-handling.ts",
          "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/proper-error-handling.ts"
        ]
      },
      {
        "name": "ajv",
        "version": "^8.12.0",
        "source": "package.json",
        "hasContract": true,
        "contractVersion": "1.0.0",
        "usedIn": []
      },
      {
        "name": "axios",
        "version": "unknown",
        "source": "import",
        "hasContract": true,
        "contractVersion": "1.0.0",
        "usedIn": [
          "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/instance-usage.ts",
          "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/proper-error-handling.ts"
        ]
      },
      {
        "name": "typescript",
        "version": "^5.3.3",
        "source": "package.json",
        "hasContract": true,
        "contractVersion": "1.0.0",
        "usedIn": []
      },
      {
        "name": "@behavioral-contracts/corpus",
        "version": "^1.0.0",
        "source": "package.json",
        "hasContract": false,
        "usedIn": []
      },
      {
        "name": "@types/node",
        "version": "^20.11.0",
        "source": "package.json",
        "hasContract": false,
        "usedIn": []
      },
      {
        "name": "@typescript-eslint/eslint-plugin",
        "version": "^6.19.0",
        "source": "package.json",
        "hasContract": false,
        "usedIn": []
      },
      {
        "name": "@typescript-eslint/parser",
        "version": "^6.19.0",
        "source": "package.json",
        "hasContract": false,
        "usedIn": []
      },
      {
        "name": "chalk",
        "version": "^5.3.0",
        "source": "package.json",
        "hasContract": false,
        "usedIn": []
      },
      {
        "name": "commander",
        "version": "^12.0.0",
        "source": "package.json",
        "hasContract": false,
        "usedIn": []
      },
      {
        "name": "eslint",
        "version": "^8.56.0",
        "source": "package.json",
        "hasContract": false,
        "usedIn": []
      },
      {
        "name": "glob",
        "version": "^10.3.10",
        "source": "package.json",
        "hasContract": false,
        "usedIn": []
      },
      {
        "name": "vitest",
        "version": "^1.2.0",
        "source": "package.json",
        "hasContract": false,
        "usedIn": []
      },
      {
        "name": "yaml",
        "version": "^2.3.4",
        "source": "package.json",
        "hasContract": false,
        "usedIn": []
      }
    ]
  },
  "violations_by_package": {
    "@tanstack/react-query": {
      "total": 11,
      "errors": 11,
      "warnings": 0,
      "info": 0,
      "violations": [
        {
          "id": "@tanstack/react-query-query-error-unhandled",
          "severity": "error",
          "file": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/instance-usage.ts",
          "line": 276,
          "column": 5,
          "package": "@tanstack/react-query",
          "function": "useQuery",
          "contract_clause": "query-error-unhandled",
          "description": "Async function 'handlePrefetch' contains unprotected await expression. await queryClient.prefetchQuery({\n      queryKey: ... may throw unhandled errors.",
          "source_doc": "https://tanstack.com/query/latest/docs/framework/react/guides/query-functions",
          "suggested_fix": "Caller MUST handle query errors using one of these methods:\n1. Check the `error` property and `isError` state returned by useQuery, OR\n2. Wrap the component in an ErrorBoundary with throwOnError: true, OR\n3. Provide an onError callback in query options.\n\nQuery errors are NOT thrown - they are returned in the error property.\nIgnoring the error state leaves users with broken UI and no feedback.\n",
          "code_snippet": {
            "startLine": 272,
            "endLine": 280,
            "lines": [
              {
                "line": 272,
                "content": "  const queryClient = useQueryClient();",
                "highlighted": false
              },
              {
                "line": 273,
                "content": "",
                "highlighted": false
              },
              {
                "line": 274,
                "content": "  const handlePrefetch = async (userId: string) => {",
                "highlighted": false
              },
              {
                "line": 275,
                "content": "    // ❌ VIOLATION: No try-catch around prefetch",
                "highlighted": false
              },
              {
                "line": 276,
                "content": "    await queryClient.prefetchQuery({",
                "highlighted": true
              },
              {
                "line": 277,
                "content": "      queryKey: ['user', userId],",
                "highlighted": false
              },
              {
                "line": 278,
                "content": "      queryFn: async () => {",
                "highlighted": false
              },
              {
                "line": 279,
                "content": "        const response = await fetch(`/api/users/${userId}`);",
                "highlighted": false
              },
              {
                "line": 280,
                "content": "        if (!response.ok) throw new Error('Prefetch failed');",
                "highlighted": false
              }
            ]
          }
        },
        {
          "id": "@tanstack/react-query-query-error-unhandled",
          "severity": "error",
          "file": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/missing-error-handling.ts",
          "line": 139,
          "column": 5,
          "package": "@tanstack/react-query",
          "function": "useQuery",
          "contract_clause": "query-error-unhandled",
          "description": "Async function 'handleSubmit' contains unprotected await expression. await mutation.mutateAsync(formData)... may throw unhandled errors.",
          "source_doc": "https://tanstack.com/query/latest/docs/framework/react/guides/query-functions",
          "suggested_fix": "Caller MUST handle query errors using one of these methods:\n1. Check the `error` property and `isError` state returned by useQuery, OR\n2. Wrap the component in an ErrorBoundary with throwOnError: true, OR\n3. Provide an onError callback in query options.\n\nQuery errors are NOT thrown - they are returned in the error property.\nIgnoring the error state leaves users with broken UI and no feedback.\n",
          "code_snippet": {
            "startLine": 135,
            "endLine": 143,
            "lines": [
              {
                "line": 135,
                "content": "  });",
                "highlighted": false
              },
              {
                "line": 136,
                "content": "",
                "highlighted": false
              },
              {
                "line": 137,
                "content": "  const handleSubmit = async (formData: { name: string }) => {",
                "highlighted": false
              },
              {
                "line": 138,
                "content": "    // ❌ VIOLATION: No try-catch around mutateAsync",
                "highlighted": false
              },
              {
                "line": 139,
                "content": "    await mutation.mutateAsync(formData);",
                "highlighted": true
              },
              {
                "line": 140,
                "content": "    console.log('User updated');",
                "highlighted": false
              },
              {
                "line": 141,
                "content": "  };",
                "highlighted": false
              },
              {
                "line": 142,
                "content": "",
                "highlighted": false
              },
              {
                "line": 143,
                "content": "  return (",
                "highlighted": false
              }
            ]
          }
        },
        {
          "id": "@tanstack/react-query-query-error-unhandled",
          "severity": "error",
          "file": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/missing-error-handling.ts",
          "line": 19,
          "column": 31,
          "package": "@tanstack/react-query",
          "function": "useQuery",
          "contract_clause": "query-error-unhandled",
          "description": "No error handling found. Errors will crash the application.",
          "source_doc": "https://tanstack.com/query/latest/docs/framework/react/guides/query-functions",
          "suggested_fix": "Caller MUST handle query errors using one of these methods:\n1. Check the `error` property and `isError` state returned by useQuery, OR\n2. Wrap the component in an ErrorBoundary with throwOnError: true, OR\n3. Provide an onError callback in query options.\n\nQuery errors are NOT thrown - they are returned in the error property.\nIgnoring the error state leaves users with broken UI and no feedback.\n",
          "code_snippet": {
            "startLine": 15,
            "endLine": 23,
            "lines": [
              {
                "line": 15,
                "content": " * ❌ Missing error handling - not checking isError or error property",
                "highlighted": false
              },
              {
                "line": 16,
                "content": " * Should trigger: query-error-unhandled",
                "highlighted": false
              },
              {
                "line": 17,
                "content": " */",
                "highlighted": false
              },
              {
                "line": 18,
                "content": "function UserProfileNoErrorHandling({ userId }: { userId: string }) {",
                "highlighted": false
              },
              {
                "line": 19,
                "content": "  const { data, isLoading } = useQuery({",
                "highlighted": true
              },
              {
                "line": 20,
                "content": "    queryKey: ['user', userId],",
                "highlighted": false
              },
              {
                "line": 21,
                "content": "    queryFn: async () => {",
                "highlighted": false
              },
              {
                "line": 22,
                "content": "      const response = await fetch(`/api/users/${userId}`);",
                "highlighted": false
              },
              {
                "line": 23,
                "content": "      if (!response.ok) throw new Error('Failed to fetch user');",
                "highlighted": false
              }
            ]
          }
        },
        {
          "id": "@tanstack/react-query-mutation-error-unhandled",
          "severity": "error",
          "file": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/missing-error-handling.ts",
          "line": 90,
          "column": 20,
          "package": "@tanstack/react-query",
          "function": "useMutation",
          "contract_clause": "mutation-error-unhandled",
          "description": "No error handling found. Errors will crash the application.",
          "source_doc": "https://tanstack.com/query/latest/docs/framework/react/guides/mutations",
          "suggested_fix": "Caller MUST handle mutation errors using one of these methods:\n1. Check the `error` property and `isError` state returned by useMutation, OR\n2. Provide onError callback in mutation options, OR\n3. Handle errors in the .catch() when calling mutate/mutateAsync, OR\n4. Configure global mutation error handler via QueryClient mutationCache.onError.\n\nMutations modify server state - users MUST know if they failed.\nSilent failures lead to data inconsistency and user confusion.\n",
          "code_snippet": {
            "startLine": 86,
            "endLine": 94,
            "lines": [
              {
                "line": 86,
                "content": " * ❌ Missing mutation error handling",
                "highlighted": false
              },
              {
                "line": 87,
                "content": " * Should trigger: mutation-error-unhandled",
                "highlighted": false
              },
              {
                "line": 88,
                "content": " */",
                "highlighted": false
              },
              {
                "line": 89,
                "content": "function CreateUserFormNoErrorHandling() {",
                "highlighted": false
              },
              {
                "line": 90,
                "content": "  const mutation = useMutation({",
                "highlighted": true
              },
              {
                "line": 91,
                "content": "    mutationFn: async (userData: { name: string; email: string }) => {",
                "highlighted": false
              },
              {
                "line": 92,
                "content": "      const response = await fetch('/api/users', {",
                "highlighted": false
              },
              {
                "line": 93,
                "content": "        method: 'POST',",
                "highlighted": false
              },
              {
                "line": 94,
                "content": "        headers: { 'Content-Type': 'application/json' },",
                "highlighted": false
              }
            ]
          }
        },
        {
          "id": "@tanstack/react-query-mutation-error-unhandled",
          "severity": "error",
          "file": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/missing-error-handling.ts",
          "line": 126,
          "column": 20,
          "package": "@tanstack/react-query",
          "function": "useMutation",
          "contract_clause": "mutation-error-unhandled",
          "description": "No error handling found. Errors will crash the application.",
          "source_doc": "https://tanstack.com/query/latest/docs/framework/react/guides/mutations",
          "suggested_fix": "Caller MUST handle mutation errors using one of these methods:\n1. Check the `error` property and `isError` state returned by useMutation, OR\n2. Provide onError callback in mutation options, OR\n3. Handle errors in the .catch() when calling mutate/mutateAsync, OR\n4. Configure global mutation error handler via QueryClient mutationCache.onError.\n\nMutations modify server state - users MUST know if they failed.\nSilent failures lead to data inconsistency and user confusion.\n",
          "code_snippet": {
            "startLine": 122,
            "endLine": 130,
            "lines": [
              {
                "line": 122,
                "content": " * ❌ Using mutateAsync without try-catch",
                "highlighted": false
              },
              {
                "line": 123,
                "content": " * Should trigger: mutation-error-unhandled",
                "highlighted": false
              },
              {
                "line": 124,
                "content": " */",
                "highlighted": false
              },
              {
                "line": 125,
                "content": "function UpdateUserFormNoTryCatch({ userId }: { userId: string }) {",
                "highlighted": false
              },
              {
                "line": 126,
                "content": "  const mutation = useMutation({",
                "highlighted": true
              },
              {
                "line": 127,
                "content": "    mutationFn: async (userData: { name: string }) => {",
                "highlighted": false
              },
              {
                "line": 128,
                "content": "      const response = await fetch(`/api/users/${userId}`, {",
                "highlighted": false
              },
              {
                "line": 129,
                "content": "        method: 'PUT',",
                "highlighted": false
              },
              {
                "line": 130,
                "content": "        body: JSON.stringify(userData),",
                "highlighted": false
              }
            ]
          }
        },
        {
          "id": "@tanstack/react-query-mutation-error-unhandled",
          "severity": "error",
          "file": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/missing-error-handling.ts",
          "line": 159,
          "column": 20,
          "package": "@tanstack/react-query",
          "function": "useMutation",
          "contract_clause": "mutation-error-unhandled",
          "description": "No error handling found. Errors will crash the application.",
          "source_doc": "https://tanstack.com/query/latest/docs/framework/react/guides/mutations",
          "suggested_fix": "Caller MUST handle mutation errors using one of these methods:\n1. Check the `error` property and `isError` state returned by useMutation, OR\n2. Provide onError callback in mutation options, OR\n3. Handle errors in the .catch() when calling mutate/mutateAsync, OR\n4. Configure global mutation error handler via QueryClient mutationCache.onError.\n\nMutations modify server state - users MUST know if they failed.\nSilent failures lead to data inconsistency and user confusion.\n",
          "code_snippet": {
            "startLine": 155,
            "endLine": 163,
            "lines": [
              {
                "line": 155,
                "content": " * ❌ Optimistic update without error rollback",
                "highlighted": false
              },
              {
                "line": 156,
                "content": " * Should trigger: mutation-optimistic-update-rollback",
                "highlighted": false
              },
              {
                "line": 157,
                "content": " */",
                "highlighted": false
              },
              {
                "line": 158,
                "content": "function TodoToggleNoRollback({ todoId, queryClient }: { todoId: string; queryClient: any }) {",
                "highlighted": false
              },
              {
                "line": 159,
                "content": "  const mutation = useMutation({",
                "highlighted": true
              },
              {
                "line": 160,
                "content": "    mutationFn: async ({ id, completed }: { id: string; completed: boolean }) => {",
                "highlighted": false
              },
              {
                "line": 161,
                "content": "      const response = await fetch(`/api/todos/${id}`, {",
                "highlighted": false
              },
              {
                "line": 162,
                "content": "        method: 'PUT',",
                "highlighted": false
              },
              {
                "line": 163,
                "content": "        body: JSON.stringify({ completed }),",
                "highlighted": false
              }
            ]
          }
        },
        {
          "id": "@tanstack/react-query-mutation-optimistic-update-rollback",
          "severity": "error",
          "file": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/missing-error-handling.ts",
          "line": 159,
          "column": 20,
          "package": "@tanstack/react-query",
          "function": "useMutation",
          "contract_clause": "mutation-optimistic-update-rollback",
          "description": "Optimistic update without rollback. UI will show incorrect data on error.",
          "source_doc": "https://tanstack.com/query/latest/docs/framework/react/guides/optimistic-updates",
          "suggested_fix": "When using optimistic updates, the onError callback MUST roll back the optimistic changes.\n\nRequired pattern:\n```\nonMutate: async (newData) => {\n  await queryClient.cancelQueries({ queryKey })\n  const previousData = queryClient.getQueryData(queryKey)\n  queryClient.setQueryData(queryKey, newData) // optimistic update\n  return { previousData } // context for rollback\n},\nonError: (err, newData, context) => {\n  queryClient.setQueryData(queryKey, context.previousData) // ROLLBACK\n}\n```\n\nWithout rollback, failed mutations leave UI showing incorrect data.\n",
          "code_snippet": {
            "startLine": 155,
            "endLine": 163,
            "lines": [
              {
                "line": 155,
                "content": " * ❌ Optimistic update without error rollback",
                "highlighted": false
              },
              {
                "line": 156,
                "content": " * Should trigger: mutation-optimistic-update-rollback",
                "highlighted": false
              },
              {
                "line": 157,
                "content": " */",
                "highlighted": false
              },
              {
                "line": 158,
                "content": "function TodoToggleNoRollback({ todoId, queryClient }: { todoId: string; queryClient: any }) {",
                "highlighted": false
              },
              {
                "line": 159,
                "content": "  const mutation = useMutation({",
                "highlighted": true
              },
              {
                "line": 160,
                "content": "    mutationFn: async ({ id, completed }: { id: string; completed: boolean }) => {",
                "highlighted": false
              },
              {
                "line": 161,
                "content": "      const response = await fetch(`/api/todos/${id}`, {",
                "highlighted": false
              },
              {
                "line": 162,
                "content": "        method: 'PUT',",
                "highlighted": false
              },
              {
                "line": 163,
                "content": "        body: JSON.stringify({ completed }),",
                "highlighted": false
              }
            ]
          }
        },
        {
          "id": "@tanstack/react-query-infinite-query-error-unhandled",
          "severity": "error",
          "file": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/missing-error-handling.ts",
          "line": 202,
          "column": 7,
          "package": "@tanstack/react-query",
          "function": "useInfiniteQuery",
          "contract_clause": "infinite-query-error-unhandled",
          "description": "No error handling found. Errors will crash the application.",
          "source_doc": "https://tanstack.com/query/latest/docs/framework/react/guides/infinite-queries",
          "suggested_fix": "Caller MUST handle errors when fetching additional pages:\n1. Check `error` and `isError` state, OR\n2. Check `fetchNextPageError` for page-specific errors, OR\n3. Provide onError callback in query options.\n\nWhen fetchNextPage fails, previously loaded pages remain accessible via `data`.\nUser must be informed that loading more failed.\n",
          "code_snippet": {
            "startLine": 198,
            "endLine": 206,
            "lines": [
              {
                "line": 198,
                "content": "    data,",
                "highlighted": false
              },
              {
                "line": 199,
                "content": "    fetchNextPage,",
                "highlighted": false
              },
              {
                "line": 200,
                "content": "    hasNextPage,",
                "highlighted": false
              },
              {
                "line": 201,
                "content": "    isFetchingNextPage,",
                "highlighted": false
              },
              {
                "line": 202,
                "content": "  } = useInfiniteQuery({",
                "highlighted": true
              },
              {
                "line": 203,
                "content": "    queryKey: ['users', 'infinite'],",
                "highlighted": false
              },
              {
                "line": 204,
                "content": "    queryFn: async ({ pageParam = 0 }) => {",
                "highlighted": false
              },
              {
                "line": 205,
                "content": "      const response = await fetch(`/api/users?page=${pageParam}`);",
                "highlighted": false
              },
              {
                "line": 206,
                "content": "      if (!response.ok) throw new Error('Failed to fetch users');",
                "highlighted": false
              }
            ]
          }
        },
        {
          "id": "@tanstack/react-query-mutation-error-unhandled",
          "severity": "error",
          "file": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/missing-error-handling.ts",
          "line": 285,
          "column": 30,
          "package": "@tanstack/react-query",
          "function": "useMutation",
          "contract_clause": "mutation-error-unhandled",
          "description": "No error handling found. Errors will crash the application.",
          "source_doc": "https://tanstack.com/query/latest/docs/framework/react/guides/mutations",
          "suggested_fix": "Caller MUST handle mutation errors using one of these methods:\n1. Check the `error` property and `isError` state returned by useMutation, OR\n2. Provide onError callback in mutation options, OR\n3. Handle errors in the .catch() when calling mutate/mutateAsync, OR\n4. Configure global mutation error handler via QueryClient mutationCache.onError.\n\nMutations modify server state - users MUST know if they failed.\nSilent failures lead to data inconsistency and user confusion.\n",
          "code_snippet": {
            "startLine": 281,
            "endLine": 289,
            "lines": [
              {
                "line": 281,
                "content": " * ❌ Parallel mutations without coordination",
                "highlighted": false
              },
              {
                "line": 282,
                "content": " * Should trigger: mutation-parallel-execution (warning)",
                "highlighted": false
              },
              {
                "line": 283,
                "content": " */",
                "highlighted": false
              },
              {
                "line": 284,
                "content": "function ParallelMutationsNoCoordination() {",
                "highlighted": false
              },
              {
                "line": 285,
                "content": "  const updateNameMutation = useMutation({",
                "highlighted": true
              },
              {
                "line": 286,
                "content": "    mutationFn: async (name: string) => {",
                "highlighted": false
              },
              {
                "line": 287,
                "content": "      const response = await fetch('/api/user/name', {",
                "highlighted": false
              },
              {
                "line": 288,
                "content": "        method: 'PUT',",
                "highlighted": false
              },
              {
                "line": 289,
                "content": "        body: JSON.stringify({ name }),",
                "highlighted": false
              }
            ]
          }
        },
        {
          "id": "@tanstack/react-query-mutation-error-unhandled",
          "severity": "error",
          "file": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/missing-error-handling.ts",
          "line": 296,
          "column": 31,
          "package": "@tanstack/react-query",
          "function": "useMutation",
          "contract_clause": "mutation-error-unhandled",
          "description": "No error handling found. Errors will crash the application.",
          "source_doc": "https://tanstack.com/query/latest/docs/framework/react/guides/mutations",
          "suggested_fix": "Caller MUST handle mutation errors using one of these methods:\n1. Check the `error` property and `isError` state returned by useMutation, OR\n2. Provide onError callback in mutation options, OR\n3. Handle errors in the .catch() when calling mutate/mutateAsync, OR\n4. Configure global mutation error handler via QueryClient mutationCache.onError.\n\nMutations modify server state - users MUST know if they failed.\nSilent failures lead to data inconsistency and user confusion.\n",
          "code_snippet": {
            "startLine": 292,
            "endLine": 300,
            "lines": [
              {
                "line": 292,
                "content": "      return response.json();",
                "highlighted": false
              },
              {
                "line": 293,
                "content": "    },",
                "highlighted": false
              },
              {
                "line": 294,
                "content": "  });",
                "highlighted": false
              },
              {
                "line": 295,
                "content": "",
                "highlighted": false
              },
              {
                "line": 296,
                "content": "  const updateEmailMutation = useMutation({",
                "highlighted": true
              },
              {
                "line": 297,
                "content": "    mutationFn: async (email: string) => {",
                "highlighted": false
              },
              {
                "line": 298,
                "content": "      const response = await fetch('/api/user/email', {",
                "highlighted": false
              },
              {
                "line": 299,
                "content": "        method: 'PUT',",
                "highlighted": false
              },
              {
                "line": 300,
                "content": "        body: JSON.stringify({ email }),",
                "highlighted": false
              }
            ]
          }
        },
        {
          "id": "@tanstack/react-query-query-error-unhandled",
          "severity": "error",
          "file": "/Users/calebgates/WebstormProjects/behavioral-contracts/corpus/packages/@tanstack/react-query/fixtures/missing-error-handling.ts",
          "line": 326,
          "column": 31,
          "package": "@tanstack/react-query",
          "function": "useQuery",
          "contract_clause": "query-error-unhandled",
          "description": "No error handling found. Errors will crash the application.",
          "source_doc": "https://tanstack.com/query/latest/docs/framework/react/guides/query-functions",
          "suggested_fix": "Caller MUST handle query errors using one of these methods:\n1. Check the `error` property and `isError` state returned by useQuery, OR\n2. Wrap the component in an ErrorBoundary with throwOnError: true, OR\n3. Provide an onError callback in query options.\n\nQuery errors are NOT thrown - they are returned in the error property.\nIgnoring the error state leaves users with broken UI and no feedback.\n",
          "code_snippet": {
            "startLine": 322,
            "endLine": 330,
            "lines": [
              {
                "line": 322,
                "content": " * ❌ Not handling background refetch errors for stale queries",
                "highlighted": false
              },
              {
                "line": 323,
                "content": " * Should trigger: stale-query-refetch-error",
                "highlighted": false
              },
              {
                "line": 324,
                "content": " */",
                "highlighted": false
              },
              {
                "line": 325,
                "content": "function StaleDataNoRefetchErrorHandling({ userId }: { userId: string }) {",
                "highlighted": false
              },
              {
                "line": 326,
                "content": "  const { data, isLoading } = useQuery({",
                "highlighted": true
              },
              {
                "line": 327,
                "content": "    queryKey: ['user', userId],",
                "highlighted": false
              },
              {
                "line": 328,
                "content": "    queryFn: async () => {",
                "highlighted": false
              },
              {
                "line": 329,
                "content": "      const response = await fetch(`/api/users/${userId}`);",
                "highlighted": false
              },
              {
                "line": 330,
                "content": "      if (!response.ok) throw new Error('Failed to fetch user');",
                "highlighted": false
              }
            ]
          }
        }
      ]
    }
  }
}